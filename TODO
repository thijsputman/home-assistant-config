<!-- vim: syntax=Markdown -->

# ToDo

- [General](#general)
- [Lovelace](#lovelace)
- [tado¬∞](#tado)
- [Lights](#lights)
- [Alarm](#alarm)

## General

- [ ] Move all icon customisations for sensors defined in YAML from
      `üìÑ customize.yaml` to their respective YAML files
- [ ] Clean-up the grossly inconsistent Zigbee entity-naming (half of them are
      `light_x`, `openclose_y`, the other half already have sensible names)
- [ ] State attributes store history too, so there's no need to create template
      sensors if they're purely used for graphing in dashboards
      (`mini-graph-card` can graph attributes) or in other automations (use a
      template to retrieve the attribute's value)
  - Main value of template sensors is to easily retrieve an attribute's history
    without having it structural on a dashboard (i.e. incidental usage)
  - See which of the current template sensors (mainly tado¬∞ related) are
    actually useful given the above considerations; remove the ones that are
    not...
- [ ] Some of the automation/helper-combinations can be replaced with template
      entities/sensors ‚Äì mainly those that effectively are nothing more than a
      set of operations on the state of one or more existing sensors:
  - ‚úîÔ∏è Time of Day / Nighttime
  - The Hue scene heuristics
- [ ] See where
      [**trigger-based template sensors**](https://www.home-assistant.io/blog/2021/04/07/release-20214/)
      can/should be used.
  - The `state_attr('sensor.xxx', 'last_reset').today().day|int` constructs
    (i.e. hacks üòâ) in [`üìÑ sensors/dsmr.yaml`](./sensors/dsmr.yaml) appear to
    be great candidates at first sight...
  - ~~Some of the binary sensors indicating device activity (e.g. those for the
    dishwasher and dryer) could be triggered with a slight delay (or with more
    elaborate conditions) to ensure a short "pauses" in their cleaning cycle
    don't incorrectly toggle the sensor off~~ More appropriate to use template
    binary sensors ‚Äì see below
- [ ] Clean up `üìÑ sensors.yaml` (i.e., move its contents into the `üìÅ sensors`
      folder). Do the same with the binary sensors (move them from
      `üìÑ configuration.yaml` into `üìÅ sensors_binary`). There's a handful of
      "regular" template sensors (`sensor.binary_...`) that should've been
      implemented as template binary sensors ‚Äì correct those
- [ ] Further enhance the (Android) companion app notifications
  - ‚úîÔ∏è Channels and grouping/threading
  - ‚úîÔ∏è Support for attachments/images
  - Change the click-action based on the notification context
- [ ] Use generic names for the mobile devices registered through the "Mobile
      App" integration (`gm1913`, `sm_g930f` and `p20hd_eea`). Knowing the model
      numbers of these devices allows one to deduce the vendor prefixes of their
      WiFi and Bluetooth MAC addresses, which in turn _could_ be used to
      pinpoint the exact location of the house (if the combination of the three
      device types is unique enough ‚Äì which it might).
- [ ] Add a "Guest-mode" toggle to stop (most of) the automations that run when
      no-one is at home from triggering
- [ ] Experiment with using the amount of rain and the (WeeWX calculated)
      evapotranspiration to indicate whether the garden should be watered
  - For now just graphing the daily delta between the two to get a bit of a
    feeling on how the data moves
  - Added `sensor.weewx_rain_day` (the daily rain tally kept by WeeWX itself) to
    compare against (i.e. validate the accuracy of) the integral calculation
- [ ] It could be nice to also track water consumption. See for example
      <https://www.ztatz.nl/p1-monitor-watermeter/>
  - Apart from tracking consumption, it could also serve as an (early) warning
    in case of water leaks
- [ ] Add a power consumption sensor to the "multimedia outlet" in the Living
      room to detect if the projector is on (in which case certain lighting
      automation should be disabled) ‚Äì as an addition to the Android TV based
      automations (which work wonderfully, but only when the Shield TV is active
      and not, for example, when the Nintendo Switch is being used)
- [ ] Enable the `retain`-attribute for all MQTT-topics (either by updating the
      publishing logic, or by manually toggling the attribute on the MQTT server
      itself?)

## Lovelace

- [ ] Refine the wakeup alarm card: Clearer state indication and visually
      combine the alarm time setting with the mute setting

## tado¬∞

- [x] ~~Create several "backstops" (controlled via HomeKit) to ensure heating is
      properly controlled when there is no access to the online Tado service~~
  - On hold till the first time this actually turns out to be an issue. As of
    yet, the Tado online service has been rock-solid...

## Lights

- [ ] For Summer: Garden light automatic off should only happen if light state
      has not been modified manually (i.e. we're sitting outside)
- [ ] The transition from "lights off at dawn" to "daytime lights on when its
      dark during the day" is not optimal yet. At the moment I'm delaying the
      latter by 10 seconds to prevent it from interfering with the former, there
      should be a nicer way to handle that...
- [ ] Failure mode for Kitchen-counter motion lights: Switch Kitchen to
      "Ambiance", trigger counter motion sensor, switch Kitchen to "Bright
      (Custom)" (while motion sensor is still active). After motion clears,
      Kitchen switches back to "Ambiance" instead of to "Bright (Custom")
- [ ] Let the occupancy simulation toggle `input_boolean.everyone_asleep` when
      it switches off all lights (easiest way to keep consistent behaviour). Do
      ensure this doesn't conflict with the alarm settings
- [ ] Use "Light Group" instead of regular groups for grouping lights
- [ ] Failure mode for Bathroom motion-sensing automation: If the light-level
      falls below its threshold while a motion sensors remains triggered, the
      light will never come on (as the automation doesn't restart until the
      motion sensor clears and retriggers). Instead of using a (preemptive)
      condition, use a waiting-loop that continuously (i.e. every 30 seconds)
      evaluates the conditions
- [ ] Failure mode for Living room Hue scene heuristic: When the brightness of
      the Ensuite ceiling lamp is increased during the "Daytime" scene, the
      detected scene does not change (most likely the overall change is too
      small ‚Äì might require a specific exception)
- [ ] When coming home late at night (i.e. all lights are off), switch on some
      lights when the front/back door opens (conditional on home alarm disarmed
      in the past few minutes)
- [ ] Daytime lights in the downstairs Hallway are switched on a bit too much...

## Alarm

- [ ] ~~Flash the colour lamps/lights bulbs in the Living Room red while the
      alarm is activated;~~ also, check if the siren's light actually flashes
      when the alarm is sounding
  - Flashing the lights serves little purpose ‚Äì better idea: Get a second Zigbee
    siren (reduces the likelihood of them getting disabled in event of an
    emergency) and have a look at
    [dresden-elektronik/deconz-rest-plugin#3232](https://github.com/dresden-elektronik/deconz-rest-plugin/issues/3232#issuecomment-688145449)
    and
    [dresden-elektronik/deconz-rest-plugin#4432](https://github.com/dresden-elektronik/deconz-rest-plugin/issues/4432#issuecomment-782841021)
    on how to properly control them through deCONZ
  - Sirens can be controlled on as lights via deCONZ/Home Assistant, but their
    state is not tracked (see
    <https://github.com/dresden-elektronik/deconz-rest-plugin/issues/4045>),
    perhaps implement this manually (mainly for logging/debugging purposes)?
- [ ] Test the alarm sirens every first Monday of the month at 12:00 (to
      coincide with the Dutch national alarm siren test)
- [ ] Replace the notifications ("motion detected when away") from the Arlo-app
      with "native" Home Assistant notifications (mainly beneficial if this
      allows to include a snapshot directly in the notification)
  - For testing purposes currently implemented as "doorbell rang when
    away"-notification
- [ ] The (Neato) robot vacuums trigger the motion sensors (and thus the alarm
      when we're away üò≥ü§ê) ‚Äì add time-based excludes to specific motion sensors
      to cope with this...
